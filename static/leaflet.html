<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Leaflet Kystverket</title>
		 <link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.3/dist/leaflet.css"
   integrity="sha512-07I2e+7D8p6he1SIM+1twR5TIrhUQn9+I6yjqD53JQjFiMf8EtC93ty0/5vJTZGF8aAocvHYNEDJajGdNx1IsQ=="
   crossorigin=""/>
        <script src="https://unpkg.com/leaflet@1.0.3/dist/leaflet.js"
   integrity="sha512-A7vV8IFfih/D732iSSKi20u/ooOfj/AGehOKq0f4vLT1Zr2Y+RX7C+w8A1gaSasGtRUZpF/NZgzSAu4/Gc41Lg=="
   crossorigin=""></script>
   		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    </head>
    <body>
     <div id="map" style="height: 400px"></div>     
        <script>
            var map = L.map('map').setView([59.824713, 10.456367], 11);
            L.tileLayer('http://opencache.statkart.no/gatekeeper/gk/gk.open_gmaps?layers=topo2&zoom={z}&x={x}&y={y}', {
                attribution: '<a href="http://www.kartverket.no/">Kartverket</a>'
            }).addTo(map);
            
            function track_2_popup(feature) {
            	return "<table>" + 
            			"<tr><td>" + "mmsi" + "</td><td>" + feature.properties.mmsi.toString() + "</td></tr>" + 
            			"<tr><td>" + "course" + "</td><td>" + feature.properties.course.toFixed(1) + "</td></tr>" +
            			"<tr><td>" + "heading" + "</td><td>" + feature.properties.heading.toFixed(1) + "</td></tr>" +
            			"<tr><td>" + "speed" + "</td><td>" + feature.properties.speed.toFixed(1) + "</td></tr>" +
            			"<tr><td>" + "last" + "</td><td>" + feature.properties.timestamp + "</td></tr>" +
            			"</table>"
            }
            
            function onEachFeature(feature, layer) {
                // does this feature have a property named popupContent?
                if (feature.properties && feature.properties.mmsi) {
                    layer.bindPopup(track_2_popup(feature));
                }
            }
            
            
            $(document).ready(function(){
                $.getJSON("/api/tracks", function(geojsonFeatures){
                    	L.geoJSON(geojsonFeatures, {
                    		onEachFeature: onEachFeature
                    	}).addTo(map);
                });
                
                $(window).on("resize", function () { $("#map").height($(window).height()); map.invalidateSize(); }).trigger("resize");
            });
        </script>
    </body>
</html>
